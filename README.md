# dreepo

Repository Pattern implementation for Firebase Realtime Database

[![TypeScript](https://badgen.net/badge/-/typescript?icon=typescript&label)](https://www.typescriptlang.org/)
[![tested with jest](https://img.shields.io/badge/tested_with-jest-99424f.svg)](https://github.com/facebook/jest)

## Overview

[Getting Started](#getting-started)  
[Installation](#installation)  
[Usage](#ðŸš§-usage)  
[Built With](#built-with)  
[Contributing](docs/CONTRIBUTING.md)

## Getting Started

Inspired by [Fireorm][1], Dreepo exposes a Repository Pattern implementation for
[Firebase Realtime Database][2] instances.

Alongside an abstract database access layer, repositories also support:

- aggregation pipelines and queries using [mingo][3], a MongoDB query language
- [runtypes][4] model validation

## Installation

1. Create or edit an `.npmrc` file with the following information:

   ```utf-8
   @flex-development:registry=https://npm.pkg.github.com/
   //npm.pkg.github.com/:_authToken=${GH_PAT}
   ```

   where `GH_PAT` is your [GitHub personal access token][5] with
   [`read:packages`][6] scope permissions.

2. Add project to `dependencies`

   ```zsh
   yarn add @flex-development/dreepo # or npm i @flex-development/dreepo
   ```

## Usage

[Configuration](#configuration)  
[Creating a New Model & Repository](#creating-a-new-model-&-repository)  
[CRUD Operations](#crud-operations)  
[Schema Validation](#schema-validation)  
[Contributing](docs/CONTRIBUTING.md)

### Configuration

#### Firebase Service Account

1. Navigate to [Service Accounts][7] section of the Firebase console

2. Click **Generate New Private Key** to generate a new service account key file
   if you do not have one already

   Dreepo communicates with your Realtime Database using the [Firebase Database
   REST API][2].

   [Google OAuth2 access tokens][8], generated by service accounts, are used to
   authenticate requests.

#### Environment Variables

- `DEBUG`: Toggle [debug][9] logs from the `dreepo` namespace
- `DEBUG_COLORS`: Toggle [debug][9] log namespace colors
- `FIREBASE_CLIENT_EMAIL`: Firebase Admin service account `client_email`
- `FIREBASE_DATABASE_URL`: Firebase Realtime Database URL
- `FIREBASE_PRIVATE_KEY`: Firebase Admin service account `private_key`

### Creating a New Model & Repository

**TODO**: Update documentation.

### CRUD Operations

**TODO**: Update documentation.

### Schema Validation

**TODO**: Update documentation.

## Built With

- [Axios][10] - Promise based HTTP client
- [Firebase Database REST API][2] - REST API for Firebase Realtime Database
- [Google APIs Node.js Client][11] - Node.js client library for using Google
  APIs
- [debug][9] - JavaScript debugging utility
- [mingo][3] - MongoDB query language for in-memory objects
- [runtypes][4] - Runtime validation for static types

[1]: https://github.com/wovalle/fireorm
[2]: https://firebase.google.com/docs/reference/rest/database
[3]: https://github.com/kofrasa/mingo
[4]: https://github.com/pelotom/runtypes
[5]:
  https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token
[6]:
  https://docs.github.com/en/developers/apps/scopes-for-oauth-apps#available-scopes
[7]:
  https://console.firebase.google.com/project/_/settings/serviceaccounts/adminsdk
[8]: https://developers.google.com/identity/protocols/oauth2
[9]: https://github.com/visionmedia/debug
[10]: https://github.com/axios/axios
[11]: https://github.com/googleapis/google-api-nodejs-client
